---
import AppLayout from "../../layouts/AppLayout.astro";
import PostCard from "../../components/PostCard.astro";
import SearchPanel from "../../components/SearchPanel.astro";
import { getCollection } from "astro:content";
import { estimateWordCount, getCategoryLabel } from "../../utils/postMeta";

const title = "全部文章";
const posts = (await getCollection("blog"))
  .filter((p) => !p.data.draft)
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());
---

<AppLayout title={title} description="全部文章列表">


  {posts.length === 0 ? (
    <p class="empty">暂无文章。</p>
  ) : (
    <div class="feed-grid">
      {posts.map((p) => (
        <PostCard
          post={p}
          categoryLabel={getCategoryLabel(p.id)}
          wordCount={estimateWordCount(p.body)}
        />
      ))}
    </div>
  )}

  <SearchPanel slot="right" />
</AppLayout>

<style>
  .category-head {
    margin-bottom: 24px;
  }

  .empty {
    color: #666;
  }


  .feed-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, 280px);
    gap: 24px;
    align-items: start;
  }
</style>
