---
import AppLayout from "../../../layouts/AppLayout.astro";
import FormattedDate from "../../../components/FormattedDate.astro";
import { getCollection } from "astro:content";

export async function getStaticPaths() {
  const posts = await getCollection("blog");
  const categories = new Set(
    posts.map((p) => p.id.split("/")[0]).filter(Boolean),
  );

  return Array.from(categories).map((category) => ({
    params: { category },
  }));
}

const { category } = Astro.params;
const labels = {
  summary: "总结",
  talk: "随想",
  creation: "创作",
  study: "学习",
  diary: "日记",
};
const title = labels[category] ?? category;
const posts = (await getCollection("blog"))
  .filter((p) => !p.data.draft && p.id.startsWith(`${category}/`))
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());
---

<AppLayout title={title} description={`${title}分类`}>
  <section class="category-head">
    <h1>{title}</h1>
    <p>这里是 {title} 分类的文章。</p>
  </section>

  {posts.length === 0 ? (
    <p class="empty">暂无文章。</p>
  ) : (
    <div class="feed-grid">
      {posts.map((p) => (
        <article class="post-card">
          <a class="card-link" href={`/blog/${p.id.replace(/\.(md|mdx)$/, "")}/`}>
            <h3 class="card-title">{p.data.title}</h3>
            <p class="card-desc">{p.data.description}</p>
            <div class="card-meta">
              <span class="meta-item">
                <FormattedDate date={p.data.pubDate} />
              </span>
              {p.data.tags?.length > 0 && (
                <span class="meta-item">{p.data.tags.slice(0, 2).join(" / ")}</span>
              )}
            </div>
          </a>
        </article>
      ))}
    </div>
  )}
</AppLayout>

<style>
  .category-head {
    margin-bottom: 24px;
  }

  .empty {
    color: #666;
  }

  .feed-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
    gap: 24px;
  }

  .post-card {
    border-radius: 16px;
    background: rgba(255, 255, 255, 0.3);
    border: 1px solid rgba(255, 255, 255, 0.6);
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08);
    backdrop-filter: blur(8px);
    overflow: hidden;
  }

  .card-link {
    display: block;
    padding: 20px;
    color: inherit;
    text-decoration: none;
  }

  .card-title {
    font-size: 1.15rem;
    margin: 0 0 8px 0;
  }

  .card-desc {
    font-size: 0.95rem;
    color: #555;
    margin: 0 0 12px 0;
  }

  .card-meta {
    display: flex;
    gap: 12px;
    font-size: 0.85rem;
    color: #777;
  }
</style>
