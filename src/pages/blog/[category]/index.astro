---
import AppLayout from "../../../layouts/AppLayout.astro";
import PostCard from "../../../components/PostCard.astro";
import SearchPanel from "../../../components/SearchPanel.astro";
import { getCollection } from "astro:content";
import {
  CATEGORY_LABELS,
  estimateWordCount,
  getCategoryLabel,
} from "../../../utils/postMeta";

export async function getStaticPaths() {
  const categories = Object.keys(CATEGORY_LABELS);
  return categories.map((category) => ({ params: { category } }));
}

const { category } = Astro.params;
const title = CATEGORY_LABELS[category] ?? category;
const posts = (await getCollection("blog"))
  .filter((p) => !p.data.draft && p.id.startsWith(`${category}/`))
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());
---

<AppLayout title={title} description={`${title}分类`}>


  {posts.length === 0 ? (
    <p class="empty">暂无文章。</p>
  ) : (
    <div class="feed-grid">
      {posts.map((p) => (
        <PostCard
          post={p}
          categoryLabel={getCategoryLabel(p.id)}
          wordCount={estimateWordCount(p.body)}
        />
      ))}
    </div>
  )}

  <SearchPanel slot="right" />
</AppLayout>

<style>
  .category-head {
    margin-bottom: 24px;
  }

  .empty {
    color: #666;
  }


  .feed-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, 280px);
    gap: 24px;
    align-items: start;
  }
</style>
