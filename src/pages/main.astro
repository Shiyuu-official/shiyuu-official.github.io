---
import AppLayout from "../layouts/AppLayout.astro";
import FormattedDate from "../components/FormattedDate.astro";
import { getCollection } from "astro:content";

// Home page: show the latest posts.
const latest = (await getCollection("blog"))
  .filter((p) => !p.data.draft)
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())
  .slice(0, 6);
---

<AppLayout title="你的站点名" description="一句话介绍">
  <section class="home-hero">
    <h1>欢迎来到我的小站</h1>
    <p>这里可以写一句你的自我介绍/标语。</p>
  </section>

  <section class="home-feed">
    <div class="section-head">
      <h2>最新文章</h2>
      <a class="more-link" href="/blog">查看全部</a>
    </div>

    <div class="feed-grid">
      {latest.map((p) => (
        <article class="post-card">
          <a class="card-link" href={`/blog/${p.id.replace(/\.(md|mdx)$/, "")}/`}>
            <h3 class="card-title">{p.data.title}</h3>
            <p class="card-desc">{p.data.description}</p>
            <div class="card-meta">
              <span class="meta-item">
                <FormattedDate date={p.data.pubDate} />
              </span>
              {p.data.tags?.length > 0 && (
                <span class="meta-item">{p.data.tags.slice(0, 2).join(" / ")}</span>
              )}
            </div>
          </a>
        </article>
      ))}
    </div>
  </section>
</AppLayout>

<style>
  .home-hero {
    margin-bottom: 32px;
  }

  .section-head {
    display: flex;
    align-items: baseline;
    justify-content: space-between;
    gap: 16px;
    margin-bottom: 16px;
  }

  .more-link {
    font-size: 0.9rem;
    text-decoration: none;
    color: #2a82f0;
  }

  .feed-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
    gap: 24px;
  }

  .post-card {
    border-radius: 16px;
    background: rgba(255, 255, 255, 0.3);
    border: 1px solid rgba(255, 255, 255, 0.6);
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08);
    backdrop-filter: blur(8px);
    overflow: hidden;
  }

  .card-link {
    display: block;
    padding: 20px;
    color: inherit;
    text-decoration: none;
  }

  .card-title {
    font-size: 1.15rem;
    margin: 0 0 8px 0;
  }

  .card-desc {
    font-size: 0.95rem;
    color: #555;
    margin: 0 0 12px 0;
  }

  .card-meta {
    display: flex;
    gap: 12px;
    font-size: 0.85rem;
    color: #777;
  }
</style>
